@page "/register"
@layout AuthLayout

@inject AuthService AuthService
@inject NavigationManager Nav

<div class="auth-page">
    <div class="auth-card">
        <h1 class="game-title">CARDENTIS</h1>
        <h2 class="form-title">Rejestracja</h2>

        <EditForm Model="model" OnValidSubmit="HandleRegister" id="registerForm">
            <DataAnnotationsValidator />

            <div class="form-group">
                <InputText @bind-Value="model.Username" placeholder="Login" />
                <ValidationMessage For="@(() => model.Username)" />
            </div>

            <div class="form-group">
                <InputText @bind-Value="model.Email" placeholder="Email" />
                <ValidationMessage For="@(() => model.Email)" />
            </div>

            <div class="form-group">
                <InputText @bind-Value="model.Password" type="password" placeholder="Hasło" />
                <ValidationMessage For="@(() => model.Password)" />
            </div>
        </EditForm>

        <button type="submit" form="registerForm" class="secondary-btn">
            Utwórz konto
        </button>

        <button class="secondary-btn" @onclick="GoToLogin">
            Mam już konto
        </button>
    </div>
</div>

@code {
    private RegisterRequest model = new();

    private async Task HandleRegister()
    {
        var result = await AuthService.Register(model);

        if (result.Success)
            Nav.NavigateTo("/login");
    }

    private void GoToLogin() => Nav.NavigateTo("/login");
}
